# Desarrollo con Vite (incluye hot-reload)
FROM node:18-alpine

WORKDIR /app

# Copiar archivos de configuración de dependencias
COPY package.json yarn.lock* package-lock.json* pnpm-lock.yaml* ./

# Instalar dependencias
RUN npm install -g pnpm && pnpm install

# Copiar el resto de los archivos
COPY . .

# Exponer puerto de Vite
EXPOSE 5173

# Comando para desarrollo (hot-reload)
CMD ["pnpm", "run", "dev", "--host"]


# Etapa de construcción
FROM node:18-alpine AS builder

WORKDIR /app

# Copiar archivos de configuración
COPY package.json yarn.lock* package-lock.json* pnpm-lock.yaml* ./

# Instalar dependencias y construir
RUN npm install -g pnpm && pnpm install
COPY . .
RUN pnpm run build

# Etapa de producción
FROM nginx:alpine

# Copiar los archivos construidos
COPY --from=builder /app/dist /usr/share/nginx/html

# Configuración de nginx para SPA (opcional)
RUN echo 'server { \
    listen 80; \
    location / { \
      root /usr/share/nginx/html; \
      try_files \$uri /index.html; \
    } \
  }' > /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]